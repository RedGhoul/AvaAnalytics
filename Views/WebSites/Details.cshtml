@model SharpCounter.Enities.WebSites

@{
    ViewData["Title"] = "Details";
}

<div class="row">
    <h3>@Model.Name</h3>
    <hr />
    <dl class="row">
        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.APIKey)
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.APIKey)
        </dd>
        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.Name)
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.Name)
        </dd>
        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.HomePageLink)
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.HomePageLink)
        </dd>
        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.CreatedAt)
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.CreatedAt)
        </dd>
        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.UpdatedAt)
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.UpdatedAt)
        </dd>
    </dl>
</div>
<div class="row">
    <h4>Statistics For The Last 30 Mins</h4>
</div>
<div class="row">
    <div class="col-12">
        <canvas id="bar-chart-BrowserStats" width="130" height="30"></canvas>
    </div>
</div>
<div class="row">
    <div class="col-12">
        <canvas id="bar-chart-InteractionStats" width="130" height="30"></canvas>
    </div>
</div>
<div class="row">
    <div class="col-12">
        <canvas id="bar-chart-SystemStats" width="130" height="30"></canvas>
    </div>
</div>
<div>
    <a asp-action="Edit" asp-route-id="@Model.Id">Edit</a> |
    <a asp-action="Index">Back to List</a>
</div>
@section Scripts{
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js" integrity="sha256-R4pqcOYV8lt7snxMQO/HSbVCFRPMdrhAFMH+vr9giYI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.19.2/axios.min.js"
            integrity="sha256-T/f7Sju1ZfNNfBh7skWn0idlCBcI3RwdLSS4/I7NQKQ=" crossorigin="anonymous"></script>
    <script>
        let Blabels = [];
        let Bdata = [];
        axios.get('/api/Stats/BrowserStats/@Model.Id')
            .then(function (response) {
                let data = response.data;
                data.forEach(stat => {
                    Blabels.push(stat.browser + " " + stat.version);
                    Bdata.push(stat.count);
                });
            })
            .catch(function (error) {
                console.log(error);
            })
            .then(function () {
                new Chart(document.getElementById("bar-chart-BrowserStats"), {
                    type: 'horizontalBar',
                    data: {
                        labels: Blabels,
                        datasets: [
                            {
                                label: "Counts",
                                backgroundColor: ["#3e95cd", "#8e5ea2", "#3cba9f", "#e8c3b9", "#c45850"],
                                data: Bdata
                            }
                        ]
                    },
                    options: {
                        legend: { display: false },
                        title: {
                            fontSize: 14,
                            display: true,
                            text: 'Browser Stats'
                        },
                        scales: {
                            yAxes: [{ ticks: { fontSize: 14, fontFamily: "'Roboto', sans-serif", fontColor: '#000', fontStyle: '500' } }],
                            xAxes: [{ ticks: { fontSize: 14, fontFamily: "'Roboto', sans-serif", fontColor: '#000', fontStyle: '500' } }]
                        }
                    }
                });
            });

    </script>
    <script>
        let Ilabels = [];
        let Idata = [];
        axios.get('/api/Stats/InteractionStats/@Model.Id')
            .then(function (response) {
                let data = response.data;
                console.log(data)
                data.forEach(stat => {
                    Ilabels.push(stat.path);
                    Idata.push(stat.total);
                });
            })
            .catch(function (error) {
                console.log(error);
            })
            .then(function () {
                new Chart(document.getElementById("bar-chart-InteractionStats"), {
                    type: 'horizontalBar',
                    data: {
                        labels: Ilabels,
                        datasets: [
                            {
                                label: "Counts",
                                backgroundColor: ["#3e95cd", "#8e5ea2", "#3cba9f", "#e8c3b9", "#c45850"],
                                data: Idata
                            }
                        ]
                    },
                    options: {
                        legend: { display: false },
                        title: {
                            fontSize: 14,
                            display: true,
                            text: 'Page Interactions'
                        },
                        scales: {
                            yAxes: [{ ticks: { fontSize: 14, fontFamily: "'Roboto', sans-serif", fontColor: '#000', fontStyle: '500' } }],
                            xAxes: [{ ticks: { fontSize: 14, fontFamily: "'Roboto', sans-serif", fontColor: '#000', fontStyle: '500' } }]
                        }
                    }
                });
            });

    </script>
    <script>
        let Slabels = [];
        let Sdata = [];
        axios.get('/api/Stats/SystemStats/@Model.Id')
            .then(function (response) {
                let data = response.data;
                console.log(data)
                data.forEach(stat => {
                    Slabels.push(stat.platform + " " + stat.version);
                    Sdata.push(stat.count);
                });
            })
            .catch(function (error) {
                console.log(error);
            })
            .then(function () {
                new Chart(document.getElementById("bar-chart-SystemStats"), {
                    type: 'horizontalBar',
                    data: {
                        labels: Slabels,
                        datasets: [
                            {
                                label: "Counts",
                                backgroundColor: ["#3e95cd", "#8e5ea2", "#3cba9f", "#e8c3b9", "#c45850"],
                                data: Sdata
                            }
                        ]
                    },
                    options: {
                        legend: { display: false },
                        title: {
                            fontSize: 14,
                            display: true,
                            text: 'System Stats'
                        },
                        scales: {
                            yAxes: [{ ticks: { fontSize: 14, fontFamily: "'Roboto', sans-serif", fontColor: '#000', fontStyle: '500' } }],
                            xAxes: [{ ticks: { fontSize: 14, fontFamily: "'Roboto', sans-serif", fontColor: '#000', fontStyle: '500' } }]
                        }
                    }
                });
            });

    </script>
}